#!/bin/bash

# PScreen CLI Tool
APP_DIR="/usr/local/lib/pscreen"

if [ ! -d "$APP_DIR" ]; then
    echo "‚ùå PScreen –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
    exit 1
fi

cd "$APP_DIR"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
if [ "$1" = "--version" ] || [ "$1" = "-v" ]; then
    echo "PScreen CLI Tool v1.0.1"
    exit 0
fi

if [ "$1" = "--help" ] || [ "$1" = "-h" ]; then
    echo "PScreen - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –≤–µ–±-—Å–∞–π—Ç–æ–≤"
    echo ""
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:"
    echo "  pscreen              - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º"
    echo "  pscreen <url>        - –ë—ã—Å—Ç—Ä—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç URL"
    echo "  pscreen --version    - –ü–æ–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é"
    echo "  pscreen --help       - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É"
    exit 0
fi

# –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω URL –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
if [ "$1" ]; then
    echo "üéØ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –¥–ª—è: $1"
    node src/cli/index.js take "$1" --width 1920 --height 1080 --fullPage true --server true
    exit $?
fi

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
echo "üéØ PScreen - –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤"
echo "=============================================="

read -p "üåê –í–≤–µ–¥–∏—Ç–µ URL —Å–∞–π—Ç–∞: " url
if [ -z "$url" ]; then
    echo "‚ùå URL –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º"
    exit 1
fi

echo ""
echo "üìê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞:"
read -p "   –®–∏—Ä–∏–Ω–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1920): " width
width=${width:-1920}

read -p "   –í—ã—Å–æ—Ç–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1080): " height  
height=${height:-1080}

read -p "   –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞? (y/N): " fullpage
if [[ "$fullpage" =~ ^[Yy]$ ]]; then
    fullpage="true"
else
    fullpage="false"
fi

read -p "   –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä? (Y/n): " server
if [[ "$server" =~ ^[Nn]$ ]]; then
    server="false"
else
    server="true"
fi

echo ""
echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞..."
echo "   URL: $url"
echo "   –†–∞–∑–º–µ—Ä: ${width}x${height}"
echo "   –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: $fullpage"
echo "   –í–µ–±-—Å–µ—Ä–≤–µ—Ä: $server"
echo ""

node src/cli/index.js take "$url" --width "$width" --height "$height" --fullPage "$fullpage" --server "$server"
