<% if (externalIpInfo && baseUrl) { %>
<div class="ip-info">
    <h3>üåç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ</h3>
    <div class="ip-display">IP: <%= externalIpInfo.ip %></div>
    <div class="url-info">
        <strong>–ë–∞–∑–æ–≤—ã–π URL:</strong> <a href="<%= baseUrl %>" target="_blank"><%= baseUrl %></a>
    </div>
    <div class="meta">
        –ò—Å—Ç–æ—á–Ω–∏–∫ IP: <%= sourceLabels[externalIpInfo.source] || externalIpInfo.source %> | 
        –í—Ä–µ–º—è: <%= new Date(externalIpInfo.timestamp).toLocaleString('ru-RU') %>
        <% if (externalIpInfo.warning) { %> | ‚ö†Ô∏è <%= externalIpInfo.warning %><% } %>
    </div>
    <div class="ip-controls">
        <button onclick="refreshIP()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å IP</button>
        <button class="secondary" onclick="clearCache()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à</button>
        <button class="secondary" onclick="window.open('/api/external-ip', '_blank')">üìÑ API</button>
    </div>
</div>
<% } %>

<div class="api-section">
    <h3>üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ IP</h3>
    <div class="api-endpoints">
        <div class="api-endpoint">
            <h4><span class="method">GET</span> /api/external-ip</h4>
            <p>–ü–æ–ª—É—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π IP –∞–¥—Ä–µ—Å</p>
            <a href="/api/external-ip" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
        <div class="api-endpoint">
            <h4><span class="method">GET</span> /api/external-ip?force=true</h4>
            <p>–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å IP</p>
            <a href="/api/external-ip?force=true" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
        <div class="api-endpoint">
            <h4><span class="method">GET</span> /api/cache-info</h4>
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–µ—à–µ</p>
            <a href="/api/cache-info" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
        <div class="api-endpoint">
            <h4><span class="method post">POST</span> /api/cache/clear</h4>
            <p>–û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à IP</p>
        </div>
        <div class="api-endpoint">
            <h4><span class="method">GET</span> /api/config</h4>
            <p>–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</p>
            <a href="/api/config" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
        </div>
        <div class="api-endpoint">
            <h4><span class="method post">POST</span> /api/config</h4>
            <p>–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</p>
        </div>
    </div>
</div>

<% if (domains.length === 0) { %>
<div class="no-data">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤</div>
<% } else { %>
<table class="session-table">
    <thead>
        <tr>
            <th>–î–æ–º–µ–Ω</th>
            <th>–°–µ—Å—Å–∏—è</th>
            <th>–î–∞—Ç–∞</th>
            <th>–§–∞–π–ª—ã</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        <% domains.forEach(function(domain) { %>
            <% domain.sessions.forEach(function(session) { %>
                <tr>
                    <td>üåê <%= domain.name %></td>
                    <td><a href="/view/<%= domain.name %>/<%= session.name %>">üìÖ <%= session.date %></a></td>
                    <td><%= session.date %></td>
                    <td>üìä <%= session.fileCount %> —Ñ–∞–π–ª–æ–≤</td>
                    <td>
                        <a href="/view/<%= domain.name %>/<%= session.name %>">üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä</a> |
                        <a href="/download/<%= domain.name %>/<%= session.name %>">üíæ –°–∫–∞—á–∞—Ç—å</a>
                    </td>
                </tr>
            <% }); %>
        <% }); %>
    </tbody>
</table>
<% } %>
