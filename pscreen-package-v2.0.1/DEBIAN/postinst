#!/bin/bash
set -e

echo "ğŸ”§ Installing PScreen CLI v2.0.1..."

# Install dependencies in the package directory
cd /usr/local/lib/pscreen
npm install --production --silent 2>/dev/null || {
    echo "âš ï¸  Warning: npm install failed, trying alternative method..."
    npm install --production --no-optional --silent 2>/dev/null || true
}

# Install Playwright browsers
echo "ğŸ“¥ Installing Playwright browsers..."
npx playwright install chromium --quiet 2>/dev/null || {
    echo "âš ï¸  Warning: Failed to install Playwright browsers automatically"
    echo "   You can install them manually with: npx playwright install"
}

# Set permissions
chmod +x /usr/local/bin/pscreen

echo "âœ… PScreen CLI v2.0.1 installation completed!"
echo "ğŸ“‹ Run 'pscreen --help' to get started"
echo "ğŸŒ New in v2.0.1: Automatic port conflict resolution"

exit 0
